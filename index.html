<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Kalp Toplama Oyunu</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      touch-action: none;
      position: fixed;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
    }
    .controlButton {
      position: absolute;
      bottom: 20px;
      padding: 20px;
      background-color: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 24px;
      border-radius: 50%;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      touch-action: manipulation;
    }
    #jumpButton {
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #leftButton {
      left: 20px;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #rightButton {
      right: 20px;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <div id="jumpButton" class="controlButton">↑</div>
  <div id="leftButton" class="controlButton">←</div>
  <div id="rightButton" class="controlButton">→</div>

  <img id="face1" src="https://i.hizliresim.com/r6bm8a9.png" style="display: none;">
  <img id="face2" src="https://i.hizliresim.com/37shbzf.png" style="display: none;">

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let score = 0;
    let lives = 3;
    let gravity = 0.5;
    let jumpStrength = 12;
    let gameStarted = false;
    let offsetY = 0;
    let moveLeft = false;
    let moveRight = false;

    let character1 = {};
    let character2 = {};
    let platforms = [];
    let hearts = [];

    function initGame() {
      // Oyunu başlat
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      // Karakter özelliklerini tanımla
      const characterSize = Math.min(canvas.width / 10, 40);
      
      character1 = {
        x: canvas.width / 2 - characterSize * 1.5,
        y: canvas.height - 150,
        width: characterSize,
        height: characterSize,
        velX: 0,
        velY: 0,
        speed: canvas.width / 100,
        grounded: false
      };

      character2 = {
        x: canvas.width / 2 + characterSize * 0.5,
        y: canvas.height - 150,
        width: characterSize,
        height: characterSize,
        velX: 0,
        velY: 0,
        speed: canvas.width / 100,
        grounded: false
      };

      // İlk platformu oluştur
      platforms = [{
        x: canvas.width / 2 - 100,
        y: canvas.height - 100,
        width: 200,
        height: 20
      }];

      // Ekstra platformlar ekle
      for (let i = 0; i < 5; i++) {
        createPlatform(canvas.height - 200 - i * 120);
      }

      // İlk kalpleri oluştur
      for (let i = 0; i < 3; i++) {
        createHeart(canvas.height - 250 - i * 120);
      }

      gameStarted = true;
    }

    function resizeCanvas() {
      const oldWidth = canvas.width;
      const oldHeight = canvas.height;
      
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      if (gameStarted) {
        // Tüm oyun nesnelerinin ölçeklerini ayarla
        const widthRatio = canvas.width / oldWidth;
        const heightRatio = canvas.height / oldHeight;
        
        character1.x *= widthRatio;
        character1.y *= heightRatio;
        character1.width = Math.min(canvas.width / 10, 40);
        character1.height = Math.min(canvas.width / 10, 40);
        character1.speed = canvas.width / 100;
        
        character2.x *= widthRatio;
        character2.y *= heightRatio;
        character2.width = Math.min(canvas.width / 10, 40);
        character2.height = Math.min(canvas.width / 10, 40);
        character2.speed = canvas.width / 100;
        
        platforms.forEach(platform => {
          platform.x *= widthRatio;
          platform.width *= widthRatio;
          platform.y *= heightRatio;
        });
        
        hearts.forEach(heart => {
          heart.x *= widthRatio;
          heart.y *= heightRatio;
        });
      }
    }

    window.addEventListener("resize", resizeCanvas);
    
    // Dokunmatik ekran için etkinlik dinleyicileri
    document.getElementById("jumpButton").addEventListener("touchstart", function(e) {
      e.preventDefault();
      if (character1.grounded) {
        character1.velY = -jumpStrength;
        character1.grounded = false;
      }
      if (character2.grounded) {
        character2.velY = -jumpStrength;
        character2.grounded = false;
      }
    }, { passive: false });
    
    document.getElementById("jumpButton").addEventListener("mousedown", function() {
      if (character1.grounded) {
        character1.velY = -jumpStrength;
        character1.grounded = false;
      }
      if (character2.grounded) {
        character2.velY = -jumpStrength;
        character2.grounded = false;
      }
    });

    document.getElementById("leftButton").addEventListener("touchstart", function(e) {
      e.preventDefault();
      moveLeft = true;
    }, { passive: false });

    document.getElementById("leftButton").addEventListener("touchend", function(e) {
      e.preventDefault();
      moveLeft = false;
    }, { passive: false });

    document.getElementById("rightButton").addEventListener("touchstart", function(e) {
      e.preventDefault();
      moveRight = true;
    }, { passive: false });

    document.getElementById("rightButton").addEventListener("touchend", function(e) {
      e.preventDefault();
      moveRight = false;
    }, { passive: false });
    
    // Fare kontrolü
    document.getElementById("leftButton").addEventListener("mousedown", function() {
      moveLeft = true;
    });

    document.getElementById("leftButton").addEventListener("mouseup", function() {
      moveLeft = false;
    });
    
    document.getElementById("leftButton").addEventListener("mouseleave", function() {
      moveLeft = false;
    });

    document.getElementById("rightButton").addEventListener("mousedown", function() {
      moveRight = true;
    });

    document.getElementById("rightButton").addEventListener("mouseup", function() {
      moveRight = false;
    });
    
    document.getElementById("rightButton").addEventListener("mouseleave", function() {
      moveRight = false;
    });

    function createPlatform(yPosition) {
      const minWidth = canvas.width * 0.2;
      const maxWidth = canvas.width * 0.4;
      const platformWidth = minWidth + Math.random() * (maxWidth - minWidth);
      
      const platform = {
        x: Math.random() * (canvas.width - platformWidth),
        y: yPosition,
        width: platformWidth,
        height: 20
      };
      platforms.push(platform);
    }

    function createHeart(yPosition) {
      const heart = {
        x: Math.random() * (canvas.width - 40),
        y: yPosition,
        size: Math.min(canvas.width / 15, 30),
        collected: false
      };
      hearts.push(heart);
    }

    function updatePlatformsAndHearts() {
      // Platform oluşturma olasılığı
      if (Math.random() < 0.02) {
        createPlatform(-20 - offsetY);
        // Her platformla birlikte bir kalp oluştur
        createHeart(-40 - offsetY);
      }
    }

    function drawPlatforms() {
      platforms.forEach((platform) => {
        ctx.fillStyle = "green";
        ctx.fillRect(platform.x, platform.y - offsetY, platform.width, platform.height);
      });
    }

    function drawHearts() {
      hearts.forEach((heart) => {
        if (!heart.collected) {
          const size = heart.size || 20;
          ctx.fillStyle = "red";
          ctx.beginPath();
          const centerX = heart.x + size/2;
          const centerY = heart.y - offsetY + size/2;
          
          // Kalp çizimi
          ctx.moveTo(centerX, centerY - size/4);
          ctx.bezierCurveTo(
            centerX - size/2, centerY - size/2,
            centerX - size/2, centerY + size/4,
            centerX, centerY + size/2
          );
          ctx.bezierCurveTo(
            centerX + size/2, centerY + size/4,
            centerX + size/2, centerY - size/2,
            centerX, centerY - size/4
          );
          ctx.fill();
        }
      });
    }

    function drawCharacter() {
      const face1 = document.getElementById("face1");
      const face2 = document.getElementById("face2");

      ctx.drawImage(face1, character1.x, character1.y - offsetY - character1.height/2, character1.width, character1.height);
      ctx.drawImage(face2, character2.x, character2.y - offsetY - character2.height/2, character2.width, character2.height);
    }

    function updateCharacter() {
      // Karakterlerin dikey hızı
      character1.velY += gravity;
      character2.velY += gravity;

      // Karakterlerin dikey konumu
      character1.y += character1.velY;
      character2.y += character2.velY;

      // Karakterlerin yatay konumu
      character1.x += character1.velX;
      character2.x += character2.velX;

      // Ekran sınırları kontrolü
      if (character1.x < 0) character1.x = 0;
      if (character2.x < 0) character2.x = 0;

      if (character1.x + character1.width > canvas.width) character1.x = canvas.width - character1.width;
      if (character2.x + character2.width > canvas.width) character2.x = canvas.width - character2.width;

      // Zeminde mi kontrolü
      character1.grounded = false;
      character2.grounded = false;

      // Ekranın alt sınırı kontrolü
      if (character1.y + character1.height > canvas.height + offsetY) {
        character1.y = canvas.height + offsetY - character1.height;
        character1.grounded = true;
        character1.velY = 0;
      }

      if (character2.y + character2.height > canvas.height + offsetY) {
        character2.y = canvas.height + offsetY - character2.height;
        character2.grounded = true;
        character2.velY = 0;
      }

      // Platform çarpışma kontrolleri
      platforms.forEach((platform) => {
        if (character1.x + character1.width > platform.x && 
            character1.x < platform.x + platform.width && 
            character1.y + character1.height <= platform.y + offsetY && 
            character1.y + character1.height + character1.velY >= platform.y + offsetY) {
          character1.y = platform.y + offsetY - character1.height;
          character1.velY = 0;
          character1.grounded = true;
        }

        if (character2.x + character2.width > platform.x && 
            character2.x < platform.x + platform.width && 
            character2.y + character2.height <= platform.y + offsetY && 
            character2.y + character2.height + character2.velY >= platform.y + offsetY) {
          character2.y = platform.y + offsetY - character2.height;
          character2.velY = 0;
          character2.grounded = true;
        }
      });

      // Kalp toplama kontrolü
      hearts.forEach((heart) => {
        const heartSize = heart.size || 20;
        if (!heart.collected && 
            character1.x + character1.width > heart.x && 
            character1.x < heart.x + heartSize && 
            character1.y < heart.y + heartSize + offsetY &&
            character1.y + character1.height > heart.y + offsetY) {
          heart.collected = true;
          score++;
        }
        if (!heart.collected && 
            character2.x + character2.width > heart.x && 
            character2.x < heart.x + heartSize && 
            character2.y < heart.y + heartSize + offsetY &&
            character2.y + character2.height > heart.y + offsetY) {
          heart.collected = true;
          score++;
        }
      });
    }

    function movePlatforms() {
      // Platformları aşağı kaydır
      platforms.forEach((platform) => {
        platform.y += 2;
      });
      
      // Kalpleri aşağı kaydır
      hearts.forEach((heart) => {
        heart.y += 2;
      });

      // Yeni platformlar ve kalpler
      updatePlatformsAndHearts();
      
      // Ekran dışına çıkanları kaldır
      platforms = platforms.filter(platform => platform.y < canvas.height + 100 + offsetY);
      hearts = hearts.filter(heart => heart.y < canvas.height + 100 + offsetY);
    }

    function drawUI() {
      // Skor ve can bilgisi
      ctx.fillStyle = "black";
      ctx.font = Math.max(16, Math.min(24, canvas.width / 20)) + "px Arial";
      ctx.fillText(`Skor: ${score}`, 30, 30);
      ctx.fillText(`Canlar: ${lives}`, 30, 60);
    }

    function gameLoop() {
      if (!gameStarted) {
        initGame();
      }
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Hareket yönü
      if (moveLeft) {
        character1.velX = -character1.speed;
        character2.velX = -character2.speed;
      } else if (moveRight) {
        character1.velX = character1.speed;
        character2.velX = character2.speed;
      } else {
        character1.velX = 0;
        character2.velX = 0;
      }
      
      // Offseti güncelle - ekran yukarı kaydırma
      offsetY += 1;
      
      updateCharacter();
      movePlatforms();
      drawPlatforms();
      drawHearts();
      drawCharacter();
      drawUI();

      // Karakter ekran dışına çıktı mı
      if (character1.y > canvas.height + offsetY + 100 || 
         character2.y > canvas.height + offsetY + 100) {
        lives--;
        if (lives <= 0) {
          alert("Oyun Bitti! Skorunuz: " + score);
          // Oyunu sıfırla
          score = 0;
          lives = 3;
          offsetY = 0;
          platforms = [];
          hearts = [];
          gameStarted = false;
          initGame();
        } else {
          // Karakterleri yeniden platformun üzerine yerleştir
          const lowestPlatform = platforms.reduce((lowest, platform) => 
            platform.y > lowest.y ? platform : lowest, platforms[0]);
          
          character1.y = lowestPlatform.y - character1.height;
          character1.velY = 0;
          character2.y = lowestPlatform.y - character2.height;
          character2.velY = 0;
        }
      }

      requestAnimationFrame(gameLoop);
    }

    // Oyun döngüsünü başlat
    gameLoop();
  </script>
</body>
</html>
